on:
  push:
  pull_request:
  workflow_dispatch:

name: Test - Kustomization
jobs:
  test-image:
    name: Test - Image
    runs-on: ubuntu-22.04
    steps:

    - name: Checkout
      uses: actions/checkout@v3

    - name: Kustomize - Build
      run: kustomize build './test/kustomize' > deployment.yaml

    - name: Get commit SHA
      id: commit
      run: echo "::set-output name=sha::$(git rev-parse HEAD)"

    - name: Update - Image
      uses: JonathanAtCenterEdge/update-deployment-yaml@${{ steps.commit.outputs.sha }}
      with:
        image: test
        container: whoami-container
        deployment: ./deployment.yaml

    - run: cat ./deployment.yaml
