on:
  push:
  pull_request:
  workflow_dispatch:

name: Test - Kustomization
jobs:
  test-image:
    name: Test - Image
    runs-on: ubuntu-22.04
    steps:

    - name: Checkout
      uses: actions/checkout@v3

    - name: Bake
      run: kustomize build './test/kustomize' > deployment.yaml

    - name: Update
      uses: JonathanAtCenterEdge/update-deployment-yaml@main
      with:
        image: test
        container: whoami-container
        deployment: ./deployment.yaml
        env: TEXT_RESPONSE=00000-00000000-0000000

    - run: cat ./deployment.yaml
